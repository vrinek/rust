<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `thread` mod in crate `std`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, thread">

    <title>std::thread - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../main.css">

    <link rel="shortcut icon" href="http://www.rust-lang.org/favicon.ico">
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <section class="sidebar">
        <a href='../../std/index.html'><img src='http://www.rust-lang.org/logos/rust-logo-128x128-blk-v2.png' alt='' width='100'></a>
        <p class='location'><a href='../index.html'>std</a></p><div class='block mod'><h2>Modules</h2><a class='mod ' href='../any/index.html' title='Traits for dynamic typing of any `&#39;static` type (through runtime reflection)'>any</a><a class='mod ' href='../ascii/index.html' title='Operations on ASCII strings and characters'>ascii</a><a class='mod ' href='../borrow/index.html' title='A module for working with borrowed data.'>borrow</a><a class='mod ' href='../boxed/index.html' title='A pointer type for heap allocation.'>boxed</a><a class='mod ' href='../cell/index.html' title='Shareable mutable containers.'>cell</a><a class='mod ' href='../char/index.html' title='Character manipulation (`char` type, Unicode Scalar Value)'>char</a><a class='mod ' href='../clone/index.html' title='The `Clone` trait for types that cannot be &#39;implicitly copied&#39;'>clone</a><a class='mod ' href='../cmp/index.html' title='Defines the `PartialOrd` and `PartialEq` comparison traits.'>cmp</a><a class='mod ' href='../collections/index.html' title='Collection types.'>collections</a><a class='mod ' href='../default/index.html' title='The `Default` trait for types which may have meaningful default values.'>default</a><a class='mod ' href='../dynamic_lib/index.html' title='Dynamic library facilities.'>dynamic_lib</a><a class='mod ' href='../env/index.html' title='Inspection and manipulation of the process&#39;s environment.'>env</a><a class='mod ' href='../error/index.html' title='Traits for working with Errors.'>error</a><a class='mod ' href='../f32/index.html' title='Operations and constants for 32-bits floats (`f32` type)'>f32</a><a class='mod ' href='../f64/index.html' title='Operations and constants for 64-bits floats (`f64` type)'>f64</a><a class='mod ' href='../ffi/index.html' title='Utilities related to FFI bindings.'>ffi</a><a class='mod ' href='../finally/index.html' title='The Finally trait provides a method, `finally` on stack closures that emulates Java-style try/finally blocks.'>finally</a><a class='mod ' href='../fmt/index.html' title='Utilities for formatting and printing strings'>fmt</a><a class='mod ' href='../hash/index.html' title='Generic hashing support.'>hash</a><a class='mod ' href='../i16/index.html' title='Operations and constants for signed 16-bits integers (`i16` type)'>i16</a><a class='mod ' href='../i32/index.html' title='Operations and constants for signed 32-bits integers (`i32` type)'>i32</a><a class='mod ' href='../i64/index.html' title='Operations and constants for signed 64-bits integers (`i64` type)'>i64</a><a class='mod ' href='../i8/index.html' title='Operations and constants for signed 8-bits integers (`i8` type)'>i8</a><a class='mod ' href='../int/index.html' title='Deprecated: replaced by `isize`.'>int</a><a class='mod ' href='../intrinsics/index.html' title='rustc compiler intrinsics.'>intrinsics</a><a class='mod ' href='../isize/index.html' title='Operations and constants for pointer-sized signed integers (`isize` type)'>isize</a><a class='mod ' href='../iter/index.html' title='Composable external iterators'>iter</a><a class='mod ' href='../marker/index.html' title='Primitive traits and marker types representing basic &#39;kinds&#39; of types.'>marker</a><a class='mod ' href='../mem/index.html' title='Basic functions for dealing with memory'>mem</a><a class='mod ' href='../num/index.html' title='Numeric traits and functions for generic mathematics'>num</a><a class='mod ' href='../old_io/index.html' title='I/O, including files, networking, timers, and processes'>old_io</a><a class='mod ' href='../ops/index.html' title='Overloadable operators'>ops</a><a class='mod ' href='../option/index.html' title='Optional values'>option</a><a class='mod ' href='../os/index.html' title='Higher-level interfaces to libc::* functions and operating system services.'>os</a><a class='mod ' href='../path/index.html' title='Cross-platform path support'>path</a><a class='mod ' href='../prelude/index.html' title='The Rust prelude'>prelude</a><a class='mod ' href='../ptr/index.html' title='Operations on unsafe pointers, `*const T`, and `*mut T`.'>ptr</a><a class='mod ' href='../rand/index.html' title='Utilities for random number generation'>rand</a><a class='mod ' href='../raw/index.html' title='Contains struct definitions for the layout of compiler built-in types.'>raw</a><a class='mod ' href='../rc/index.html' title='Thread-local reference-counted boxes (the `Rc&lt;T&gt;` type).'>rc</a><a class='mod ' href='../result/index.html' title='Error handling with the `Result` type'>result</a><a class='mod ' href='../rt/index.html' title='Runtime services'>rt</a><a class='mod ' href='../simd/index.html' title='SIMD vectors.'>simd</a><a class='mod ' href='../slice/index.html' title='Utilities for slice manipulation'>slice</a><a class='mod ' href='../str/index.html' title='Unicode string manipulation (`str` type)'>str</a><a class='mod ' href='../string/index.html' title='An owned, growable string that enforces that its contents are valid UTF-8.'>string</a><a class='mod ' href='../sync/index.html' title='Useful synchronization primitives'>sync</a><a class='mod current' href='../thread/index.html' title='Native threads'>thread</a><a class='mod ' href='../thread_local/index.html' title='Thread local storage'>thread_local</a><a class='mod ' href='../thunk/index.html' title=''>thunk</a><a class='mod ' href='../time/index.html' title='Temporal quantification.'>time</a><a class='mod ' href='../u16/index.html' title='Operations and constants for unsigned 16-bits integers (`u16` type)'>u16</a><a class='mod ' href='../u32/index.html' title='Operations and constants for unsigned 32-bits integers (`u32` type)'>u32</a><a class='mod ' href='../u64/index.html' title='Operations and constants for unsigned 64-bits integer (`u64` type)'>u64</a><a class='mod ' href='../u8/index.html' title='Operations and constants for unsigned 8-bits integers (`u8` type)'>u8</a><a class='mod ' href='../uint/index.html' title='Deprecated: replaced by `usize`.'>uint</a><a class='mod ' href='../usize/index.html' title='Operations and constants for pointer-sized unsigned integers (`usize` type)'>usize</a><a class='mod ' href='../vec/index.html' title='A growable list type with heap-allocated contents, written `Vec&lt;T&gt;` but pronounced &#39;vector.&#39;'>vec</a></div><div class='block macro'><h2>Macros</h2><a class='macro ' href='../macro.assert!.html' title='Ensure that a boolean expression is `true` at runtime.'>assert!</a><a class='macro ' href='../macro.assert_eq!.html' title='Asserts that two expressions are equal to each other, testing equality in both directions.'>assert_eq!</a><a class='macro ' href='../macro.cfg!.html' title='Boolean evaluation of configuration flags.'>cfg!</a><a class='macro ' href='../macro.column!.html' title='A macro which expands to the column number on which it was invoked.'>column!</a><a class='macro ' href='../macro.concat!.html' title='Concatenates literals into a static string slice.'>concat!</a><a class='macro ' href='../macro.concat_idents!.html' title='Concatenate identifiers into one identifier.'>concat_idents!</a><a class='macro ' href='../macro.debug_assert!.html' title='Ensure that a boolean expression is `true` at runtime.'>debug_assert!</a><a class='macro ' href='../macro.debug_assert_eq!.html' title='Asserts that two expressions are equal to each other, testing equality in both directions.'>debug_assert_eq!</a><a class='macro ' href='../macro.env!.html' title='Inspect an environment variable at compile time.'>env!</a><a class='macro ' href='../macro.file!.html' title='A macro which expands to the file name from which it was invoked.'>file!</a><a class='macro ' href='../macro.format!.html' title='Use the syntax described in `std::fmt` to create a value of type `String`. See `std::fmt` for more information.'>format!</a><a class='macro ' href='../macro.format_args!.html' title='The core macro for formatted string creation &amp; output.'>format_args!</a><a class='macro ' href='../macro.include_bytes!.html' title='Includes a file as a byte slice.'>include_bytes!</a><a class='macro ' href='../macro.include_str!.html' title='Includes a utf8-encoded file as a string.'>include_str!</a><a class='macro ' href='../macro.line!.html' title='A macro which expands to the line number on which it was invoked.'>line!</a><a class='macro ' href='../macro.module_path!.html' title='Expands to a string that represents the current module path.'>module_path!</a><a class='macro ' href='../macro.option_env!.html' title='Optionally inspect an environment variable at compile time.'>option_env!</a><a class='macro ' href='../macro.panic!.html' title='The entry point for panic of Rust tasks.'>panic!</a><a class='macro ' href='../macro.print!.html' title='Equivalent to the `println!` macro except that a newline is not printed at the end of the message.'>print!</a><a class='macro ' href='../macro.println!.html' title='Macro for printing to a task&#39;s stdout handle.'>println!</a><a class='macro ' href='../macro.scoped_thread_local!.html' title='Declare a new scoped thread local storage key.'>scoped_thread_local!</a><a class='macro ' href='../macro.select!.html' title='A macro to select an event from a number of receivers.'>select!</a><a class='macro ' href='../macro.stringify!.html' title='A macro which stringifies its argument.'>stringify!</a><a class='macro ' href='../macro.thread_local!.html' title='Declare a new thread local storage key of type `std::thread_local::Key`.'>thread_local!</a><a class='macro ' href='../macro.try!.html' title='Helper macro for unwrapping `Result` values while returning early with an error if the value of the expression is `Err`. For more information, see `std::io`.'>try!</a><a class='macro ' href='../macro.unimplemented!.html' title='A standardised placeholder for marking unfinished code. It panics with the message `&quot;not yet implemented&quot;` when executed.'>unimplemented!</a><a class='macro ' href='../macro.unreachable!.html' title='A utility macro for indicating unreachable code.'>unreachable!</a><a class='macro ' href='../macro.vec!.html' title='Creates a `Vec` containing the arguments.'>vec!</a><a class='macro ' href='../macro.write!.html' title='Use the `format!` syntax to write data into a buffer of type `&amp;mut Writer`. See `std::fmt` for more information.'>write!</a><a class='macro ' href='../macro.writeln!.html' title='Equivalent to the `write!` macro, except that a newline is appended after the message is written.'>writeln!</a></div>
    </section>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press 'S' to search, '?' for more options..."
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Module <a href='../index.html'>std</a>::<wbr><a class='mod' href=''>thread</a><wbr><a class='stability Stable' title=''>Stable</a></span><span class='out-of-band'><span id='render-detail'>
            <a id="collapse-all" href="#">[-]
            </a>&nbsp;<a id="expand-all" href="#">[+]</a>
        </span><a id='src-63017' href='../../src/std/thread.rs.html#11-793'>[src]</a></span></h1>
<div class='docblock'><p>Native threads</p>

<h2 id="the-threading-model" class='section-header'><a
                           href="#the-threading-model">The threading model</a></h2>
<p>An executing Rust program consists of a collection of native OS threads,
each with their own stack and local state.</p>

<p>Communication between threads can be done through
<a href="../../std/sync/mpsc/index.html">channels</a>, Rust&#39;s message-passing
types, along with <a href="../../std/sync/index.html">other forms of thread
synchronization</a> and shared-memory data
structures. In particular, types that are guaranteed to be
threadsafe are easily shared between threads using the
atomically-reference-counted container,
<a href="../../std/sync/struct.Arc.html"><code>Arc</code></a>.</p>

<p>Fatal logic errors in Rust cause <em>thread panic</em>, during which
a thread will unwind the stack, running destructors and freeing
owned resources. Thread panic is unrecoverable from within
the panicking thread (i.e. there is no &#39;try/catch&#39; in Rust), but
panic may optionally be detected from a different thread. If
the main thread panics the application will exit with a non-zero
exit code.</p>

<p>When the main thread of a Rust program terminates, the entire program shuts
down, even if other threads are still running. However, this module provides
convenient facilities for automatically waiting for the termination of a
child thread (i.e., join), described below.</p>

<h2 id="the-thread-type" class='section-header'><a
                           href="#the-thread-type">The <code>Thread</code> type</a></h2>
<p>Already-running threads are represented via the <code>Thread</code> type, which you can
get in one of two ways:</p>

<ul>
<li>By spawning a new thread, e.g. using the <code>Thread::spawn</code> constructor;</li>
<li>By requesting the current thread, using the <code>Thread::current</code> function.</li>
</ul>

<p>Threads can be named, and provide some built-in support for low-level
synchronization described below.</p>

<p>The <code>Thread::current()</code> function is available even for threads not spawned
by the APIs of this module.</p>

<h2 id="spawning-a-thread" class='section-header'><a
                           href="#spawning-a-thread">Spawning a thread</a></h2>
<p>A new thread can be spawned using the <code>Thread::spawn</code> function:</p>
<span class='rusttest'>fn main() {
    use std::thread::Thread;
    
    let thread = Thread::spawn(move || {
        println!(&quot;Hello, World!&quot;);
        // some computation here
    });
}</span><pre id='rust-example-rendered' class='rust '>
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>thread</span>::<span class='ident'>Thread</span>;

<span class='kw'>let</span> <span class='ident'>thread</span> <span class='op'>=</span> <span class='ident'>Thread</span>::<span class='ident'>spawn</span>(<span class='kw'>move</span> <span class='op'>||</span> {
    <span class='macro'>println</span><span class='macro'>!</span>(<span class='string'>&quot;Hello, World!&quot;</span>);
    <span class='comment'>// some computation here</span>
});
</pre>

<p>The spawned thread is &quot;detached&quot; from the current thread, meaning that it
can outlive the thread that spawned it. (Note, however, that when the main
thread terminates all detached threads are terminated as well.) The returned
<code>Thread</code> handle can be used for low-level synchronization as described below.</p>

<h2 id="scoped-threads" class='section-header'><a
                           href="#scoped-threads">Scoped threads</a></h2>
<p>Often a parent thread uses a child thread to perform some particular task,
and at some point must wait for the child to complete before continuing.
For this scenario, use the <code>scoped</code> constructor:</p>
<span class='rusttest'>fn main() {
    use std::thread::Thread;
    
    let guard = Thread::scoped(move || {
        println!(&quot;Hello, World!&quot;);
        // some computation here
    });
    // do some other work in the meantime
    let result = guard.join();
}</span><pre id='rust-example-rendered' class='rust '>
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>thread</span>::<span class='ident'>Thread</span>;

<span class='kw'>let</span> <span class='ident'>guard</span> <span class='op'>=</span> <span class='ident'>Thread</span>::<span class='ident'>scoped</span>(<span class='kw'>move</span> <span class='op'>||</span> {
    <span class='macro'>println</span><span class='macro'>!</span>(<span class='string'>&quot;Hello, World!&quot;</span>);
    <span class='comment'>// some computation here</span>
});
<span class='comment'>// do some other work in the meantime</span>
<span class='kw'>let</span> <span class='ident'>result</span> <span class='op'>=</span> <span class='ident'>guard</span>.<span class='ident'>join</span>();
</pre>

<p>The <code>scoped</code> function doesn&#39;t return a <code>Thread</code> directly; instead, it
returns a <em>join guard</em> from which a <code>Thread</code> can be extracted. The join
guard is an RAII-style guard that will automatically join the child thread
(block until it terminates) when it is dropped. You can join the child
thread in advance by calling the <code>join</code> method on the guard, which will also
return the result produced by the thread.  A handle to the thread itself is
available via the <code>thread</code> method on the join guard.</p>

<p>(Note: eventually, the <code>scoped</code> constructor will allow the parent and child
threads to data that lives on the parent thread&#39;s stack, but some language
changes are needed before this is possible.)</p>

<h2 id="configuring-threads" class='section-header'><a
                           href="#configuring-threads">Configuring threads</a></h2>
<p>A new thread can be configured before it is spawned via the <code>Builder</code> type,
which currently allows you to set the name, stack size, and writers for
<code>println!</code> and <code>panic!</code> for the child thread:</p>
<span class='rusttest'>fn main() {
    use std::thread;
    
    thread::Builder::new().name(&quot;child1&quot;.to_string()).spawn(move || {
        println!(&quot;Hello, world!&quot;)
    });
}</span><pre id='rust-example-rendered' class='rust '>
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>thread</span>;

<span class='ident'>thread</span>::<span class='ident'>Builder</span>::<span class='ident'>new</span>().<span class='ident'>name</span>(<span class='string'>&quot;child1&quot;</span>.<span class='ident'>to_string</span>()).<span class='ident'>spawn</span>(<span class='kw'>move</span> <span class='op'>||</span> {
    <span class='macro'>println</span><span class='macro'>!</span>(<span class='string'>&quot;Hello, world!&quot;</span>)
});
</pre>

<h2 id="blocking-support:-park-and-unpark" class='section-header'><a
                           href="#blocking-support:-park-and-unpark">Blocking support: park and unpark</a></h2>
<p>Every thread is equipped with some basic low-level blocking support, via the
<code>park</code> and <code>unpark</code> functions.</p>

<p>Conceptually, each <code>Thread</code> handle has an associated token, which is
initially not present:</p>

<ul>
<li><p>The <code>Thread::park()</code> function blocks the current thread unless or until
the token is available for its thread handle, at which point It atomically
consumes the token. It may also return <em>spuriously</em>, without consuming the
token. <code>Thread::park_timeout()</code> does the same, but allows specifying a
maximum time to block the thread for.</p></li>
<li><p>The <code>unpark()</code> method on a <code>Thread</code> atomically makes the token available
if it wasn&#39;t already.</p></li>
</ul>

<p>In other words, each <code>Thread</code> acts a bit like a semaphore with initial count
0, except that the semaphore is <em>saturating</em> (the count cannot go above 1),
and can return spuriously.</p>

<p>The API is typically used by acquiring a handle to the current thread,
placing that handle in a shared data structure so that other threads can
find it, and then <code>park</code>ing. When some desired condition is met, another
thread calls <code>unpark</code> on the handle.</p>

<p>The motivation for this design is twofold:</p>

<ul>
<li><p>It avoids the need to allocate mutexes and condvars when building new
synchronization primitives; the threads already provide basic blocking/signaling.</p></li>
<li><p>It can be implemented highly efficiently on many platforms.</p></li>
</ul>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                    <tr>
                        <td><a class='stability Stable' title='Stable'></a><a class='struct' href='struct.Builder.html'
                               title='std::thread::Builder'>Builder</a></td>
                        <td class='docblock short'><p>Thread configuration. Provides detailed control over the properties
and behavior of new threads.</p>
</td>
                    </tr>
                
                    <tr>
                        <td><a class='stability Unstable' title='Unstable: may change with specifics of new Send semantics'></a><a class='struct' href='struct.JoinGuard.html'
                               title='std::thread::JoinGuard'>JoinGuard</a></td>
                        <td class='docblock short'><p>An RAII-style guard that will block until thread termination when dropped.</p>
</td>
                    </tr>
                
                    <tr>
                        <td><a class='stability Stable' title='Stable'></a><a class='struct' href='struct.Thread.html'
                               title='std::thread::Thread'>Thread</a></td>
                        <td class='docblock short'><p>A handle to a thread.</p>
</td>
                    </tr>
                </table><h2 id='types' class='section-header'><a href="#types">Type Definitions</a></h2>
<table>
                    <tr>
                        <td><a class='stability Stable' title='Stable'></a><a class='type' href='type.Result.html'
                               title='std::thread::Result'>Result</a></td>
                        <td class='docblock short'><p>Indicates the manner in which a thread exited.</p>
</td>
                    </tr>
                </table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <div id="help" class="hidden">
        <div class="shortcuts">
            <h1>Keyboard shortcuts</h1>
            <dl>
                <dt>?</dt>
                <dd>Show this help dialog</dd>
                <dt>S</dt>
                <dd>Focus the search field</dd>
                <dt>&larrb;</dt>
                <dd>Move up in search results</dd>
                <dt>&rarrb;</dt>
                <dd>Move down in search results</dd>
                <dt>&#9166;</dt>
                <dd>Go to active search result</dd>
            </dl>
        </div>
        <div class="infos">
            <h1>Search tricks</h1>
            <p>
                Prefix searches with a type followed by a colon (e.g.
                <code>fn:</code>) to restrict the search to a given type.
            </p>
            <p>
                Accepted types are: <code>fn</code>, <code>mod</code>,
                <code>struct</code>, <code>enum</code>,
                <code>trait</code>, <code>typedef</code> (or
                <code>tdef</code>).
            </p>
        </div>
    </div>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "std";
        window.playgroundUrl = "http://play.rust-lang.org/";
    </script>
    <script src="../../jquery.js"></script>
    <script src="../../main.js"></script>
    <script src="../../playpen.js"></script>
    <script async src="../../search-index.js"></script>
</body>
</html>